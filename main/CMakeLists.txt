INCLUDE_DIRECTORIES(
  ../src/gui
)

INCLUDE(${QT_USE_FILE})
ADD_DEFINITIONS(${QT_DEFINITIONS})

ADD_EXECUTABLE(${PROJECT_NAME} MACOSX_BUNDLE WIN32 main.cpp)
TARGET_LINK_LIBRARIES(${PROJECT_NAME} ${QT_LIBRARIES} src)

INSTALL(TARGETS ${PROJECT_NAME} 
        BUNDLE DESTINATION . COMPONENT Runtime
        RUNTIME DESTINATION . COMPONENT Runtime) 

SET(DIRS ${QT_LIBRARY_DIR} ${LIBRARY_OUTPUT_PATH})
if (WIN32)
	SET(GENERATOR "NSIS")
	SET(PROJECT_EXTENSION "exe")
	LIST(APPEND DIRS "C:/Program Files/qjson/bin")
elseif (APPLE)
	SET(GENERATOR "DragNDrop")
	SET(PROJECT_EXTENSION "app")
    LIST(APPEND DIRS "/usr/local/lib")  
	#
	SET(MACOSX_BUNDLE_ICON_FILE "${CMAKE_CURRENT_SOURCE_DIR}/Resources/QSeriesHunter.icns")
	SET_SOURCE_FILES_PROPERTIES(${MACOSX_BUNDLE_ICON_FILE} PROPERTIES MACOSX_PACKAGE_LOCATION Resources)
	SET(CPACK_BINARY_DRAGNDROP ON)
endif (WIN32)

INSTALL(CODE "include(BundleUtilities)
             fixup_bundle(\"\${CMAKE_INSTALL_PREFIX}/${PROJECT_NAME}.${PROJECT_EXTENSION}\"   \"\"   \"${DIRS}\")
			 " COMPONENT Runtime)

SET(CPACK_GENERATOR ${GENERATOR})
SET(CPACK_PACKAGE_VERSION_MAJOR "0")
SET(CPACK_PACKAGE_VERSION_MINOR "0")
SET(CPACK_PACKAGE_VERSION_PATCH "1")

include(CPack)